<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SÃ¶zleÅŸme - ADM Ä°nÅŸaat Proje YÃ¶netim Sistemi</title>
  <link rel="stylesheet" href="../css/style.css?v=11">
</head>
<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="../assets/adm_logo.png" alt="ADM Studio" class="sidebar-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <h1 style="display: none;">ğŸ—ï¸ ADM Ä°nÅŸaat</h1>
      </div>
      
      <nav class="sidebar-nav">
        <a href="../anasayfa.html" class="nav-item">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Anasayfa</span>
        </a>
        <a href="../projeler.html" class="nav-item">
          <span class="nav-icon">ğŸ—ï¸</span>
          <span class="nav-text">Projeler</span>
        </a>
        
        <!-- Project Navigation -->
        <div style="margin-top: 1.5rem; padding: 0 1rem; color: var(--text-secondary); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
          Proje Dashboard
        </div>
        <a href="proje-ozeti.html" class="nav-item" id="navOzet">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Proje Ã–zeti</span>
        </a>
        
        <div style="margin-top: 1.5rem; padding: 0 1rem; color: var(--text-secondary); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
          Ä°ÅŸ AkÄ±ÅŸ SÃ¼reci
        </div>
        <a href="kesif.html" class="nav-item" id="navKesif">
          <span class="nav-icon">ğŸ”</span>
          <span class="nav-text">1. KeÅŸif</span>
        </a>
        <a href="teklif.html" class="nav-item" id="navTeklif">
          <span class="nav-icon">ğŸ’¼</span>
          <span class="nav-text">2. Teklif</span>
        </a>
        <a href="sozlesme.html" class="nav-item active" id="navSozlesme">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-text">3. SÃ¶zleÅŸme</span>
        </a>
        <a href="metraj-listesi.html" class="nav-item" id="navMetraj">
          <span class="nav-icon">ğŸ“</span>
          <span class="nav-text">4. Metraj (BOQ)</span>
        </a>
        <a href="hakedis-takibi.html" class="nav-item" id="navHakedis">
          <span class="nav-icon">ğŸ’°</span>
          <span class="nav-text">5. HakediÅŸ</span>
        </a>
        <a href="odeme-takibi.html" class="nav-item" id="navOdeme">
          <span class="nav-icon">ğŸ’³</span>
          <span class="nav-text">6. Ã–deme</span>
        </a>
        
        <div style="margin-top: 1.5rem; padding: 0 1rem; color: var(--text-secondary); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">
          Destek ModÃ¼ller
        </div>
        <a href="santiye-gunlugu.html" class="nav-item" id="navGunluk">
          <span class="nav-icon">ğŸ“”</span>
          <span class="nav-text">Åantiye GÃ¼nlÃ¼ÄŸÃ¼</span>
        </a>
        <a href="stok-yonetimi.html" class="nav-item" id="navStok">
          <span class="nav-icon">ğŸ“¦</span>
          <span class="nav-text">Stok YÃ¶netimi</span>
        </a>
        <a href="butce-yonetimi.html" class="nav-item" id="navButce">
          <span class="nav-icon">ğŸ’µ</span>
          <span class="nav-text">BÃ¼tÃ§e YÃ¶netimi</span>
        </a>
        <a href="musteri-yetkileri.html" class="nav-item hidden" id="navMusteri">
          <span class="nav-icon">ğŸ‘¥</span>
          <span class="nav-text">MÃ¼ÅŸteri Yetkileri</span>
        </a>
      </nav>
      
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">ğŸ‘¤</div>
          <div class="user-details">
            <div class="user-name" id="sidebarUserName">YÃ¼kleniyor...</div>
            <div class="user-role" id="sidebarUserRole">...</div>
          </div>
        </div>
        <div class="sidebar-actions">
          <button id="sidebarThemeToggle" class="theme-toggle-btn" onclick="toggleTheme()">
            <span class="theme-option light-option">
              <span class="theme-circle">âšª</span>
              <span class="theme-label">Light</span>
            </span>
            <span class="theme-option dark-option active">
              <span class="theme-circle">âš«</span>
              <span class="theme-label">Dark</span>
            </span>
          </button>
          <button id="logoutBtn" class="logout-btn" onclick="handleLogout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Bar -->
      <div class="topbar">
        <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
          <button class="menu-toggle" id="menuToggle">â˜°</button>
          <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
            <a href="../anasayfa.html" style="color: var(--text-secondary); text-decoration: none;">Anasayfa</a>
            <span>â€º</span>
            <a href="../projeler.html" style="color: var(--text-secondary); text-decoration: none;">Projeler</a>
            <span>â€º</span>
            <span id="projectNameBreadcrumb" style="color: var(--brand-red); font-weight: 600;">YÃ¼kleniyor...</span>
          </div>
        </div>
        <div class="topbar-actions">
          <button class="btn" onclick="exportContractPDF()">
            ğŸ“„ PDF Ä°ndir
          </button>
          <button class="btn" onclick="signContract()" id="signBtn">
            âœï¸ Ä°mzala
          </button>
          <button class="btn btn-primary" onclick="activateContract()" id="activateBtn" style="display: none;">
            âœ… SÃ¶zleÅŸmeyi AktifleÅŸtir
          </button>
          <span id="userNameDisplay" class="topbar-user"></span>
        </div>
      </div>

      <div id="alertContainer"></div>

      <!-- Content Section -->
      <section class="content-section">
        <!-- Project Header -->
        <div style="background: linear-gradient(135deg, var(--brand-red) 0%, var(--brand-red-dark) 100%); color: white; padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; gap: 1.5rem; flex-wrap: wrap;">
            <div style="flex: 1;">
              <h2 id="projectName" style="margin: 0; font-size: 1.5rem;">YÃ¼kleniyor...</h2>
            </div>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
              <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 0.5rem 1rem; font-size: 0.9rem;" onclick="window.location.href='../projeler.html'">
                â† Projelere DÃ¶n
              </button>
            </div>
          </div>
        </div>

        <!-- Header -->
        <div style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem;">
          <h1 style="margin: 0 0 0.5rem 0; font-size: 1.5rem;">ğŸ“ SÃ¶zleÅŸme</h1>
          <p style="margin: 0 0 1rem 0; opacity: 0.9;">Resmi proje sÃ¶zleÅŸmesi</p>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem;">
            <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <h4 style="margin: 0 0 0.5rem 0; font-size: 0.85rem; opacity: 0.9;">SÃ¶zleÅŸme No</h4>
              <div style="font-size: 1.2rem; font-weight: bold;" id="contractNo">-</div>
            </div>
            <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <h4 style="margin: 0 0 0.5rem 0; font-size: 0.85rem; opacity: 0.9;">SÃ¶zleÅŸme TutarÄ±</h4>
              <div style="font-size: 1.2rem; font-weight: bold;" id="contractAmount">â‚º0.00</div>
            </div>
            <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <h4 style="margin: 0 0 0.5rem 0; font-size: 0.85rem; opacity: 0.9;">BaÅŸlangÄ±Ã§</h4>
              <div style="font-size: 1.2rem; font-weight: bold;" id="startDate">-</div>
            </div>
            <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <h4 style="margin: 0 0 0.5rem 0; font-size: 0.85rem; opacity: 0.9;">BitiÅŸ</h4>
              <div style="font-size: 1.2rem; font-weight: bold;" id="endDate">-</div>
            </div>
            <div style="background: rgba(255,255,255,0.15); padding: 1rem; border-radius: 8px; backdrop-filter: blur(10px);">
              <h4 style="margin: 0 0 0.5rem 0; font-size: 0.85rem; opacity: 0.9;">Durum</h4>
              <div style="font-size: 1.2rem; font-weight: bold;" id="contractStatus">Taslak</div>
            </div>
          </div>
        </div>

        <!-- Contract Details -->
        <div class="card">
          <h2 style="margin: 0 0 1.5rem 0;">ğŸ“‹ SÃ¶zleÅŸme Bilgileri</h2>
          
          <!-- Genel Bilgiler -->
          <div style="margin-bottom: 2rem;">
            <h3 style="margin: 0 0 1rem 0; font-size: 1.1rem; color: var(--text-secondary); font-weight: 600;">Genel Bilgiler</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
              
              <div class="form-group" style="margin-bottom: 0;">
                <label>SÃ¶zleÅŸme TÃ¼rÃ¼</label>
                <select id="contractType">
                  <option value="fixed">GÃ¶tÃ¼rÃ¼ Bedel</option>
                  <option value="unit">Birim Fiyat</option>
                  <option value="cost_plus">Maliyet + KÃ¢r</option>
                </select>
              </div>

              <div class="form-group" style="margin-bottom: 0;">
                <label>Ä°ÅŸveren (MÃ¼ÅŸteri)</label>
                <div style="padding: 0.875rem; background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-weight: 600;" id="clientName">-</div>
              </div>

              <div class="form-group" style="margin-bottom: 0;">
                <label>YÃ¼klenici (Firma)</label>
                <div style="padding: 0.875rem; background: var(--bg-secondary); border: 1.5px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-weight: 600;" id="companyName">-</div>
              </div>

            </div>
          </div>

          <!-- Tarih ve SÃ¼re Bilgileri -->
          <div style="margin-bottom: 2rem;">
            <h3 style="margin: 0 0 1rem 0; font-size: 1.1rem; color: var(--text-secondary); font-weight: 600;">Tarih ve SÃ¼re Bilgileri</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
              
              <div class="form-group" style="margin-bottom: 0;">
                <label>SÃ¶zleÅŸme Tarihi</label>
                <input type="date" id="contractDate">
              </div>

              <div class="form-group" style="margin-bottom: 0;">
                <label>Ä°ÅŸe BaÅŸlama Tarihi</label>
                <input type="date" id="workStartDate">
              </div>

              <div class="form-group" style="margin-bottom: 0;">
                <label>Tamamlanma SÃ¼resi (GÃ¼n)</label>
                <input type="number" id="durationDays" placeholder="GÃ¼n sayÄ±sÄ±" min="1">
              </div>

            </div>
          </div>

          <!-- Ceza ve Kabul SÃ¼releri -->
          <div style="margin-bottom: 2rem;">
            <h3 style="margin: 0 0 1rem 0; font-size: 1.1rem; color: var(--text-secondary); font-weight: 600;">Ceza ve Kabul SÃ¼releri</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
              
              <div class="form-group" style="margin-bottom: 0;">
                <label>Gecikme CezasÄ± OranÄ± (â€°)</label>
                <input type="number" id="penaltyRate" value="0.001" step="0.0001" min="0" max="0.01" placeholder="Ã–rn: 0.001">
              </div>

              <div class="form-group" style="margin-bottom: 0;">
                <label>GeÃ§ici Kabul SÃ¼resi (GÃ¼n)</label>
                <input type="number" id="provisionalAcceptance" value="15" min="1" placeholder="Ã–rn: 15">
              </div>

              <div class="form-group" style="margin-bottom: 0;">
                <label>Kesin Kabul SÃ¼resi (GÃ¼n)</label>
                <input type="number" id="finalAcceptance" value="365" min="1" placeholder="Ã–rn: 365">
              </div>

            </div>
          </div>

          <button class="btn btn-primary" onclick="saveContractDetails()">
            ğŸ’¾ Bilgileri Kaydet
          </button>
        </div>

        <!-- Contract Items -->
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2 style="margin: 0;">ğŸ“‹ SÃ¶zleÅŸme Kalemleri (Locked BOQ)</h2>
            <div style="color: var(--text-secondary); font-size: 0.9rem;">
              â„¹ï¸ Bu kalemler sÃ¶zleÅŸme imzalandÄ±ktan sonra kilitlenir
            </div>
          </div>

          <div class="table-responsive">
            <table class="boq-table" id="contractTable">
              <thead>
                <tr>
                  <th class="th-pozno">Poz No</th>
                  <th class="th-description">Ä°ÅŸ Kalemi</th>
                  <th class="th-unit">Birim</th>
                  <th class="th-quantity">SÃ¶zleÅŸme MiktarÄ±</th>
                  <th class="th-unitprice">Birim Fiyat</th>
                  <th class="th-total">Toplam</th>
                </tr>
              </thead>
              <tbody id="contractTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
                    <p>HenÃ¼z sÃ¶zleÅŸme kalemi yÃ¼klenmemiÅŸ</p>
                    <button class="btn btn-primary" onclick="importFromProposal()" style="margin-top: 1rem;">
                      ğŸ“¥ Tekliften Ä°Ã§e Aktar
                    </button>
                  </td>
                </tr>
              </tbody>
              <tfoot id="contractTableFooter" style="display: none;">
                <tr style="background: var(--bg-secondary); font-weight: bold;">
                  <td colspan="5" style="text-align: right; padding: 1rem;">TOPLAM SÃ–ZLEÅME BEDELÄ°:</td>
                  <td class="td-total" style="color: var(--brand-red); font-size: 1.2rem;" id="footerTotal">â‚º0.00</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- Payment Terms -->
        <div class="card" style="margin-top: 1.5rem;">
          <h2 style="margin: 0 0 1.5rem 0;">ğŸ’° Ã–deme ÅartlarÄ±</h2>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
            
            <div class="form-group" style="margin-bottom: 0;">
              <label>Ã–deme Tipi</label>
              <select id="paymentType">
                <option value="progress">HakediÅŸ Sistemli</option>
                <option value="milestone">Kilometre TaÅŸÄ±</option>
                <option value="advance">PeÅŸin Ã–deme</option>
              </select>
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
              <label>Avans OranÄ± (%)</label>
              <input type="number" id="advancePayment" value="0" min="0" max="100" step="1" placeholder="Ã–rn: 20">
            </div>
            
            <div class="form-group" style="margin-bottom: 0;">
              <label>HakediÅŸ Kesinti OranÄ± (%)</label>
              <input type="number" id="retentionRate" value="10" min="0" max="100" step="1" placeholder="Ã–rn: 10">
            </div>
            
          </div>
          
          <div class="form-group" style="margin-bottom: 0;">
            <label>Ã–deme ÅartlarÄ± DetayÄ±</label>
            <textarea id="paymentTerms" rows="4" placeholder="Ã–deme dÃ¶nemleri, ÅŸartlar, bankalar vb..."></textarea>
          </div>
        </div>

        <!-- Contract Clauses -->
        <div class="card" style="margin-top: 1.5rem;">
          <h2 style="margin: 0 0 1.5rem 0;">ğŸ“œ SÃ¶zleÅŸme Maddeleri</h2>
          <div class="form-group" style="margin-bottom: 0;">
            <label>Ã–zel Åartlar ve Maddeler</label>
            <textarea id="contractClauses" rows="12" placeholder="SÃ¶zleÅŸme maddeleri, Ã¶zel ÅŸartlar, sorumluluklar..."></textarea>
          </div>
          <button class="btn btn-primary" onclick="saveContractClauses()">
            ğŸ’¾ Maddeleri Kaydet
          </button>
        </div>

        <!-- Attachments -->
        <div class="card" style="margin-top: 1.5rem;">
          <h2 style="margin: 0 0 1.5rem 0;">ğŸ“ SÃ¶zleÅŸme Ekleri</h2>
          
          <div style="background: var(--bg-secondary); border: 2px dashed var(--border-color); border-radius: 12px; padding: 2rem; margin-bottom: 1.5rem; text-align: center;">
            <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.7;">ğŸ“„</div>
            <h3 style="margin: 0 0 0.5rem 0; color: var(--text-primary);">Dosya YÃ¼kle</h3>
            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1.5rem;">
              Ä°mzalÄ± sÃ¶zleÅŸme, teknik ÅŸartname, ek belgeler vb.
            </p>
            
            <div class="form-group" style="margin-bottom: 1rem;">
              <label>Dosya AÃ§Ä±klamasÄ±</label>
              <input type="text" id="attachmentDescription" placeholder="Ã–rn: Ä°mzalÄ± SÃ¶zleÅŸme, Teknik Åartname, Ek-1..." style="width: 100%; padding: 0.75rem; border: 1.5px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary);">
            </div>
            
            <input type="file" id="contractAttachment" accept="image/*,.pdf,.doc,.docx,.xls,.xlsx" style="display: none;" onchange="handleAttachmentUpload(event)">
            <button class="btn btn-primary" onclick="document.getElementById('contractAttachment').click()">
              ğŸ“ Dosya SeÃ§ ve YÃ¼kle
            </button>
            <div style="margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-secondary);">
              Desteklenen formatlar: PDF, Word, Excel, Resim (Max 32MB)
            </div>
          </div>

          <div id="attachmentsList" style="background: var(--bg-secondary); border-radius: 8px; padding: 1rem;">
            <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
              <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“­</div>
              <p>HenÃ¼z ek yÃ¼klenmemiÅŸ</p>
            </div>
          </div>
        </div>

        <!-- Signatures -->
        <div class="card" style="margin-top: 1.5rem;">
          <h2 style="margin: 0 0 1.5rem 0;">âœï¸ Ä°mzalar</h2>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
            
            <!-- Ä°ÅŸveren Ä°mzasÄ± -->
            <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 12px; padding: 1.5rem; text-align: center;">
              <div style="font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1rem;">Ä°ÅVEREN</div>
              <div style="background: white; border: 2px dashed var(--border-color); border-radius: 8px; padding: 3rem 1rem; min-height: 120px; display: flex; align-items: center; justify-content: center; font-size: 1rem; color: var(--text-secondary); margin-bottom: 1rem;" id="clientSignature">
                Ä°mza Bekleniyor
              </div>
              <div style="font-size: 0.85rem; color: var(--text-secondary);" id="clientSignDate">-</div>
            </div>

            <!-- YÃ¼klenici Ä°mzasÄ± -->
            <div style="background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 12px; padding: 1.5rem; text-align: center;">
              <div style="font-size: 0.85rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1rem;">YÃœKLENÄ°CÄ°</div>
              <div style="background: white; border: 2px dashed var(--border-color); border-radius: 8px; padding: 3rem 1rem; min-height: 120px; display: flex; align-items: center; justify-content: center; font-size: 1rem; color: var(--text-secondary); margin-bottom: 1rem;" id="contractorSignature">
                Ä°mza Bekleniyor
              </div>
              <div style="font-size: 0.85rem; color: var(--text-secondary);" id="contractorSignDate">-</div>
            </div>
            
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Scripts -->
  <script type="module" src="../js/auth.js?v=6"></script>
  <script type="module" src="../js/projects.js?v=6"></script>
  <script type="module" src="../js/app.js?v=6"></script>

  <script>
    document.getElementById('menuToggle')?.addEventListener('click', function() {
      document.querySelector('.sidebar').classList.toggle('sidebar-open');
    });

    function updateNavLinks() {
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = urlParams.get('id');
      if (projectId) {
        // Ä°ÅŸ AkÄ±ÅŸÄ± Linkleri
        const navKesif = document.getElementById('navKesif');
        const navTeklif = document.getElementById('navTeklif');
        const navSozlesme = document.getElementById('navSozlesme');
        const navMetraj = document.getElementById('navMetraj');
        const navHakedis = document.getElementById('navHakedis');
        const navOdeme = document.getElementById('navOdeme');
        // Proje & Destek Linkleri
        const navOzet = document.getElementById('navOzet');
        const navStok = document.getElementById('navStok');
        const navButce = document.getElementById('navButce');
        const navGunluk = document.getElementById('navGunluk');
        const navMusteri = document.getElementById('navMusteri');
        
        if (navKesif) navKesif.href = `kesif.html?id=${projectId}`;
        if (navTeklif) navTeklif.href = `teklif.html?id=${projectId}`;
        if (navSozlesme) navSozlesme.href = `sozlesme.html?id=${projectId}`;
        if (navMetraj) navMetraj.href = `metraj-listesi.html?id=${projectId}`;
        if (navHakedis) navHakedis.href = `hakedis-takibi.html?id=${projectId}`;
        if (navOdeme) navOdeme.href = `odeme-takibi.html?id=${projectId}`;
        if (navOzet) navOzet.href = `proje-ozeti.html?id=${projectId}`;
        if (navStok) navStok.href = `stok-yonetimi.html?id=${projectId}`;
        if (navButce) navButce.href = `butce-yonetimi.html?id=${projectId}`;
        if (navGunluk) navGunluk.href = `santiye-gunlugu.html?id=${projectId}`;
        if (navMusteri) navMusteri.href = `musteri-yetkileri.html?id=${projectId}`;
      }
    }

    function importFromProposal() {
      if (window.loadFromProposal) {
        window.loadFromProposal();
      }
    }

    function saveContractDetails() {
      if (window.updateContractDetails) {
        window.updateContractDetails();
      }
    }

    function saveContractClauses() {
      const clauses = document.getElementById('contractClauses').value;
      if (window.updateContractClauses) {
        window.updateContractClauses(clauses);
      }
    }

    function signContract() {
      if (confirm('SÃ¶zleÅŸmeyi imzalamak istediÄŸinize emin misiniz?')) {
        if (window.markContractSigned) {
          window.markContractSigned();
        }
      }
    }

    function activateContract() {
      if (confirm('SÃ¶zleÅŸmeyi aktifleÅŸtirmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz.')) {
        if (window.activateContractStatus) {
          window.activateContractStatus();
        }
      }
    }

    function exportContractPDF() {
      if (window.generateContractPDF) {
        window.generateContractPDF();
      } else {
        alert('PDF export Ã¶zelliÄŸi yakÄ±nda eklenecek');
      }
    }

    function handleAttachmentUpload(event) {
      if (window.uploadContractAttachment) {
        window.uploadContractAttachment(event);
      }
    }

    updateNavLinks();
  </script>

  <script type="module">
    import { db, auth } from '../js/firebase-config.js';
    import { doc, getDoc, collection, query, where, getDocs, addDoc, updateDoc, setDoc, orderBy, deleteDoc, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { IMGBB_API_KEY, IMGBB_UPLOAD_URL, MAX_FILE_SIZE } from '../js/imgbb-config.js';

    let currentProjectId = null;
    let contractItems = [];
    let contractData = {};

    async function loadContract() {
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = urlParams.get('id');
      const fromProposal = urlParams.get('from');
      
      if (!projectId) {
        window.location.href = '../projeler.html';
        return;
      }

      currentProjectId = projectId;

      try {
        const projectDoc = await getDoc(doc(db, 'projects', projectId));
        if (!projectDoc.exists()) {
          alert('âŒ Proje bulunamadÄ±');
          window.location.href = '../projeler.html';
          return;
        }

        const project = { id: projectDoc.id, ...projectDoc.data() };
        document.getElementById('projectName').textContent = project.name || 'Proje';
        document.getElementById('projectNameBreadcrumb').textContent = project.name || 'Proje';
        document.getElementById('clientName').textContent = project.clientName || '-';
        document.getElementById('companyName').textContent = project.companyName || '-';

        // Check if coming from proposal
        if (fromProposal === 'proposal') {
          const proposalData = sessionStorage.getItem('proposalToContract');
          if (proposalData) {
            await importProposalData(JSON.parse(proposalData));
            sessionStorage.removeItem('proposalToContract');
          }
        }

        // Load contract metadata
        const contractDocRef = doc(db, 'contracts', projectId);
        const contractDoc = await getDoc(contractDocRef);
        
        if (contractDoc.exists()) {
          contractData = contractDoc.data();
          
          document.getElementById('contractNo').textContent = contractData.contractNo || '-';
          document.getElementById('contractAmount').textContent = formatCurrency(contractData.contractAmount || 0);
          
          if (contractData.contractDate) {
            document.getElementById('contractDate').value = contractData.contractDate;
            document.getElementById('startDate').textContent = new Date(contractData.contractDate).toLocaleDateString('tr-TR');
          }
          
          if (contractData.workStartDate) {
            document.getElementById('workStartDate').value = contractData.workStartDate;
          }
          
          if (contractData.durationDays) {
            document.getElementById('durationDays').value = contractData.durationDays;
            const endDate = new Date(contractData.workStartDate);
            endDate.setDate(endDate.getDate() + contractData.durationDays);
            document.getElementById('endDate').textContent = endDate.toLocaleDateString('tr-TR');
          }

          if (contractData.contractType) document.getElementById('contractType').value = contractData.contractType;
          if (contractData.penaltyRate !== undefined) document.getElementById('penaltyRate').value = contractData.penaltyRate;
          if (contractData.provisionalAcceptance) document.getElementById('provisionalAcceptance').value = contractData.provisionalAcceptance;
          if (contractData.finalAcceptance) document.getElementById('finalAcceptance').value = contractData.finalAcceptance;
          if (contractData.paymentType) document.getElementById('paymentType').value = contractData.paymentType;
          if (contractData.advancePayment !== undefined) document.getElementById('advancePayment').value = contractData.advancePayment;
          if (contractData.retentionRate !== undefined) document.getElementById('retentionRate').value = contractData.retentionRate;
          if (contractData.paymentTerms) document.getElementById('paymentTerms').value = contractData.paymentTerms;
          if (contractData.clauses) document.getElementById('contractClauses').value = contractData.clauses;

          // Load client and contractor info from contract metadata
          if (contractData.client && contractData.client.name) {
            document.getElementById('clientName').textContent = contractData.client.name;
          }
          if (contractData.contractor && contractData.contractor.name) {
            document.getElementById('companyName').textContent = contractData.contractor.name;
          }

          const statusMap = {
            draft: 'Taslak',
            pending: 'Onay Bekliyor',
            signed: 'Ä°mzalandÄ±',
            active: 'Aktif',
            completed: 'TamamlandÄ±',
            terminated: 'Feshedildi'
          };
          document.getElementById('contractStatus').textContent = statusMap[contractData.status] || 'Taslak';

          // Show activate button if signed
          if (contractData.status === 'signed') {
            document.getElementById('activateBtn').style.display = 'inline-block';
          }

          // Show signatures
          if (contractData.clientSignedAt) {
            const clientSigDiv = document.getElementById('clientSignature');
            clientSigDiv.innerHTML = '<div style="font-size: 2.5rem; margin-bottom: 0.5rem;">âœ…</div><strong style="color: var(--success-color); font-size: 1.1rem;">Ä°mzalandÄ±</strong>';
            clientSigDiv.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%)';
            clientSigDiv.style.borderColor = 'var(--success-color)';
            clientSigDiv.style.borderStyle = 'solid';
            document.getElementById('clientSignDate').textContent = contractData.clientSignedAt.toDate().toLocaleString('tr-TR');
          }
          if (contractData.contractorSignedAt) {
            const contractorSigDiv = document.getElementById('contractorSignature');
            contractorSigDiv.innerHTML = '<div style="font-size: 2.5rem; margin-bottom: 0.5rem;">âœ…</div><strong style="color: var(--success-color); font-size: 1.1rem;">Ä°mzalandÄ±</strong>';
            contractorSigDiv.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%)';
            contractorSigDiv.style.borderColor = 'var(--success-color)';
            contractorSigDiv.style.borderStyle = 'solid';
            document.getElementById('contractorSignDate').textContent = contractData.contractorSignedAt.toDate().toLocaleString('tr-TR');
          }
        }

        // Load contract items
        const itemsQuery = query(
          collection(db, 'contract_items'),
          where('projectId', '==', projectId),
          where('isDeleted', '==', false),
          orderBy('pozNo', 'asc')
        );
        const itemsSnap = await getDocs(itemsQuery);
        contractItems = [];
        
        itemsSnap.forEach(docSnap => {
          contractItems.push({ id: docSnap.id, ...docSnap.data() });
        });

        renderContractTable();

      } catch (error) {
        console.error('âŒ Error loading contract:', error);
        alert('SÃ¶zleÅŸme verileri yÃ¼klenirken hata: ' + error.message);
      }

      // Load attachments
      loadContractAttachments();
    }

    async function importProposalData(proposalData) {
      try {
        const user = auth.currentUser;
        let totalAmount = 0;

        // Import items
        for (let i = 0; i < proposalData.items.length; i++) {
          const item = proposalData.items[i];
          const itemTotal = (item.quantity || 0) * (item.unitPrice || 0);
          totalAmount += itemTotal;

          await addDoc(collection(db, 'contract_items'), {
            projectId: currentProjectId,
            pozNo: i + 1,
            name: item.name,
            category: item.category,
            unit: item.unit,
            contractQuantity: item.quantity,
            unitPrice: item.unitPrice,
            description: item.description,
            fromProposalId: proposalData.proposalId,
            isLocked: false,
            isDeleted: false,
            createdAt: Timestamp.now(),
            createdBy: user.uid
          });
        }

        // Get project data for client/contractor info
        const projectDocRef = doc(db, 'projects', currentProjectId);
        const projectDocSnap = await getDoc(projectDocRef);
        const projectData = projectDocSnap.exists() ? projectDocSnap.data() : {};

        // Get company data for contractor info
        const companyDocRef = doc(db, 'companies', projectData.companyId || 'default-company');
        const companyDocSnap = await getDoc(companyDocRef);
        const companyData = companyDocSnap.exists() ? companyDocSnap.data() : {};

        // Create contract metadata with client and contractor info
        const contractDocRef = doc(db, 'contracts', currentProjectId);
        await setDoc(contractDocRef, {
          projectId: currentProjectId,
          contractNo: `SZL-${Date.now()}`,
          contractAmount: totalAmount,
          contractType: 'fixed',
          penaltyRate: 0.001,
          provisionalAcceptance: 15,
          finalAcceptance: 365,
          paymentType: 'progress',
          advancePayment: 0,
          retentionRate: 10,
          status: 'draft',
          
          // Client/Employer info (Ä°ÅŸveren)
          client: {
            name: projectData.clientName || projectData.name || 'MÃ¼ÅŸteri AdÄ±',
            company: projectData.clientCompany || '',
            email: projectData.clientEmail || '',
            phone: projectData.clientPhone || '',
            taxId: projectData.clientTaxId || '',
            address: projectData.location || projectData.clientAddress || ''
          },
          
          // Contractor info (YÃ¼klenici/Firma)
          contractor: {
            name: companyData.name || 'ADM Ä°NÅAAT A.Å.',
            taxId: companyData.taxId || '',
            address: companyData.address ? `${companyData.address.street || ''}, ${companyData.address.city || ''}`.trim() : '',
            email: companyData.email || '',
            phone: companyData.phone || ''
          },
          
          createdAt: Timestamp.now(),
          createdBy: user.uid
        });

        alert('âœ… Teklif verileri baÅŸarÄ±yla aktarÄ±ldÄ±!');

      } catch (error) {
        console.error('âŒ Error importing proposal:', error);
        alert('Teklif verileri aktarÄ±lÄ±rken hata: ' + error.message);
      }
    }

    function renderContractTable() {
      const tbody = document.getElementById('contractTableBody');
      const footer = document.getElementById('contractTableFooter');

      if (contractItems.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
              <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“</div>
              <p>HenÃ¼z sÃ¶zleÅŸme kalemi yÃ¼klenmemiÅŸ</p>
              <button class="btn btn-primary" onclick="importFromProposal()" style="margin-top: 1rem;">
                ğŸ“¥ Tekliften Ä°Ã§e Aktar
              </button>
            </td>
          </tr>
        `;
        footer.style.display = 'none';
        return;
      }

      let html = '';
      let totalAmount = 0;

      contractItems.forEach(item => {
        const total = (item.contractQuantity || 0) * (item.unitPrice || 0);
        totalAmount += total;

        html += `
          <tr class="boq-data-row">
            <td class="td-pozno">${item.pozNo}</td>
            <td class="td-description">
              <strong>${item.name}</strong>
              ${item.description ? `<br><small style="color: var(--text-secondary);">${item.description}</small>` : ''}
            </td>
            <td class="td-unit">${item.unit}</td>
            <td class="td-quantity">${formatNumber(item.contractQuantity)}</td>
            <td class="td-unitprice">${formatCurrency(item.unitPrice)}</td>
            <td class="td-total"><strong>${formatCurrency(total)}</strong></td>
          </tr>
        `;
      });

      tbody.innerHTML = html;
      footer.style.display = 'table-footer-group';
      document.getElementById('footerTotal').textContent = formatCurrency(totalAmount);
    }

    window.updateContractDetails = async function() {
      try {
        const contractDate = document.getElementById('contractDate').value;
        const workStartDate = document.getElementById('workStartDate').value;
        const durationDays = parseInt(document.getElementById('durationDays').value) || 0;

        const contractDocRef = doc(db, 'contracts', currentProjectId);
        await updateDoc(contractDocRef, {
          contractType: document.getElementById('contractType').value,
          contractDate,
          workStartDate,
          durationDays,
          penaltyRate: parseFloat(document.getElementById('penaltyRate').value),
          provisionalAcceptance: parseInt(document.getElementById('provisionalAcceptance').value),
          finalAcceptance: parseInt(document.getElementById('finalAcceptance').value),
          paymentType: document.getElementById('paymentType').value,
          advancePayment: parseFloat(document.getElementById('advancePayment').value),
          retentionRate: parseFloat(document.getElementById('retentionRate').value),
          paymentTerms: document.getElementById('paymentTerms').value
        });

        alert('âœ… SÃ¶zleÅŸme bilgileri kaydedildi');
        loadContract();

      } catch (error) {
        console.error('âŒ Error saving contract details:', error);
        alert('Bilgiler kaydedilirken hata: ' + error.message);
      }
    };

    window.updateContractClauses = async function(clauses) {
      try {
        const contractDocRef = doc(db, 'contracts', currentProjectId);
        await updateDoc(contractDocRef, { clauses });
        alert('âœ… SÃ¶zleÅŸme maddeleri kaydedildi');
      } catch (error) {
        console.error('âŒ Error saving clauses:', error);
        alert('Maddeler kaydedilirken hata: ' + error.message);
      }
    };

    window.markContractSigned = async function() {
      try {
        const contractDocRef = doc(db, 'contracts', currentProjectId);
        await updateDoc(contractDocRef, {
          status: 'signed',
          contractorSignedAt: Timestamp.now(),
          clientSignedAt: Timestamp.now()
        });

        // Lock all contract items
        for (const item of contractItems) {
          await updateDoc(doc(db, 'contract_items', item.id), {
            isLocked: true
          });
        }

        alert('âœ… SÃ¶zleÅŸme imzalandÄ± ve kalemler kilitlendi');
        loadContract();

      } catch (error) {
        console.error('âŒ Error signing contract:', error);
        alert('Ä°mzalama hatasÄ±: ' + error.message);
      }
    };

    window.activateContractStatus = async function() {
      try {
        const contractDocRef = doc(db, 'contracts', currentProjectId);
        await updateDoc(contractDocRef, {
          status: 'active',
          activatedAt: Timestamp.now()
        });

        // Export to BOQ (metraj)
        for (const item of contractItems) {
          await addDoc(collection(db, 'boq_items'), {
            projectId: currentProjectId,
            pozNo: item.pozNo,
            name: item.name,
            category: item.category,
            unit: item.unit,
            contractQuantity: item.contractQuantity,
            unitPrice: item.unitPrice,
            description: item.description,
            fromContractId: item.id,
            completedQuantity: 0,
            isDeleted: false,
            createdAt: Timestamp.now(),
            createdBy: auth.currentUser.uid
          });
        }

        alert('âœ… SÃ¶zleÅŸme aktifleÅŸtirildi ve metraj listesine aktarÄ±ldÄ±!');
        
        // Redirect to metraj page
        window.location.href = `metraj-listesi.html?id=${currentProjectId}&from=contract`;

      } catch (error) {
        console.error('âŒ Error activating contract:', error);
        alert('AktifleÅŸtirme hatasÄ±: ' + error.message);
      }
    };

    window.loadFromProposal = async function() {
      try {
        const proposalQuery = query(
          collection(db, 'proposal_items'),
          where('projectId', '==', currentProjectId),
          where('isDeleted', '==', false)
        );
        const proposalSnap = await getDocs(proposalQuery);
        
        if (proposalSnap.empty) {
          alert('âŒ Teklif kalemleri bulunamadÄ±');
          return;
        }

        const proposalItems = [];
        proposalSnap.forEach(doc => {
          proposalItems.push({ id: doc.id, ...doc.data() });
        });

        const proposalDocSnap = await getDoc(doc(db, 'proposals', currentProjectId));
        const proposalMetadata = proposalDocSnap.exists() ? proposalDocSnap.data() : {};

        await importProposalData({
          projectId: currentProjectId,
          proposalId: currentProjectId,
          items: proposalItems,
          metadata: proposalMetadata
        });

        loadContract();

      } catch (error) {
        console.error('âŒ Error loading from proposal:', error);
        alert('Tekliften yÃ¼kleme hatasÄ±: ' + error.message);
      }
    };

    function formatCurrency(amount) {
      return new Intl.NumberFormat('tr-TR', {
        style: 'currency',
        currency: 'TRY',
        minimumFractionDigits: 2
      }).format(amount || 0);
    }

    function formatNumber(num) {
      return new Intl.NumberFormat('tr-TR', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(num || 0);
    }

    // ============================================
    // ATTACHMENT MANAGEMENT
    // ============================================

    /**
     * Upload contract attachment to ImgBB
     */
    window.uploadContractAttachment = async function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const description = document.getElementById('attachmentDescription').value.trim();
      if (!description) {
        alert('âš ï¸ LÃ¼tfen dosya aÃ§Ä±klamasÄ± girin');
        return;
      }

      // Check API key
      if (!IMGBB_API_KEY || IMGBB_API_KEY === 'YOUR_IMGBB_API_KEY') {
        alert('âŒ ImgBB API key ayarlanmamÄ±ÅŸ!\n\n1. https://api.imgbb.com/ adresinden Ã¼cretsiz hesap oluÅŸturun\n2. API key\'inizi alÄ±n\n3. web/js/imgbb-config.js dosyasÄ±nda IMGBB_API_KEY deÄŸerini gÃ¼ncelleyin');
        return;
      }

      // Check file size (max 32MB for ImgBB free)
      if (file.size > MAX_FILE_SIZE) {
        alert('âŒ Dosya boyutu 32MB\'dan kÃ¼Ã§Ã¼k olmalÄ±dÄ±r');
        return;
      }

      try {
        showAlert('ğŸ“¤ Dosya yÃ¼kleniyor...', 'warning');

        // Create form data for ImgBB
        const formData = new FormData();
        formData.append('image', file);
        formData.append('name', `contract_${currentProjectId}_${Date.now()}`);

        // Upload to ImgBB
        const response = await fetch(`${IMGBB_UPLOAD_URL}?key=${IMGBB_API_KEY}`, {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error?.message || 'Upload failed');
        }

        const result = await response.json();

        if (!result.success) {
          throw new Error('Upload failed');
        }

        const imageData = result.data;
        const downloadURL = imageData.url;

        // Save metadata to Firestore
        await addDoc(collection(db, 'contract_attachments'), {
          projectId: currentProjectId,
          fileName: file.name,
          description: description,
          downloadURL: downloadURL,
          deleteURL: imageData.delete_url,
          thumbURL: imageData.thumb?.url || downloadURL,
          size: file.size,
          contentType: file.type,
          uploadedBy: auth.currentUser.uid,
          uploadedByEmail: auth.currentUser.email,
          uploadedAt: Timestamp.now(),
          provider: 'imgbb'
        });

        showAlert('âœ… Dosya baÅŸarÄ±yla yÃ¼klendi!', 'success');

        // Clear input
        document.getElementById('attachmentDescription').value = '';
        event.target.value = '';

        // Reload attachments
        loadContractAttachments();

      } catch (error) {
        console.error('âŒ Error uploading attachment:', error);
        showAlert('âŒ YÃ¼kleme hatasÄ±: ' + error.message, 'danger');
      }
    };

    /**
     * Load and display contract attachments
     */
    async function loadContractAttachments() {
      try {
        const attachmentsQuery = query(
          collection(db, 'contract_attachments'),
          where('projectId', '==', currentProjectId),
          orderBy('uploadedAt', 'desc')
        );
        const attachmentsSnap = await getDocs(attachmentsQuery);

        const attachmentsList = document.getElementById('attachmentsList');
        
        if (attachmentsSnap.empty) {
          attachmentsList.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
              <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“­</div>
              <p>HenÃ¼z ek yÃ¼klenmemiÅŸ</p>
            </div>
          `;
          return;
        }

        let html = '';
        attachmentsSnap.forEach(docSnap => {
          const attachment = docSnap.data();
          const uploadDate = attachment.uploadedAt?.toDate ? attachment.uploadedAt.toDate().toLocaleString('tr-TR') : '-';
          const fileSize = (attachment.size / 1024).toFixed(2);
          const fileIcon = getFileIcon(attachment.fileName);

          html += `
            <div style="
              display: flex;
              gap: 1rem;
              padding: 1rem;
              border-bottom: 1px solid var(--border-color);
              align-items: center;
            ">
              <div style="font-size: 2.5rem; flex-shrink: 0;">${fileIcon}</div>
              <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.25rem; word-break: break-word;">
                  ${attachment.description}
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">
                  ğŸ“„ ${attachment.fileName}
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                  ğŸ“… ${uploadDate} â€¢ ğŸ‘¤ ${attachment.uploadedByEmail || 'Bilinmeyen'} â€¢ ğŸ“¦ ${fileSize} KB
                </div>
              </div>
              <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
                <button onclick="window.open('${attachment.downloadURL}', '_blank')" 
                        class="btn btn-secondary" 
                        style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                  ğŸ‘ï¸ GÃ¶rÃ¼ntÃ¼le
                </button>
                <button onclick="deleteContractAttachment('${docSnap.id}')" 
                        class="btn btn-secondary" 
                        style="padding: 0.5rem 1rem; font-size: 0.85rem; background: var(--brand-red);">
                  ğŸ—‘ï¸ Sil
                </button>
              </div>
            </div>
          `;
        });

        attachmentsList.innerHTML = html;

      } catch (error) {
        console.error('âŒ Error loading attachments:', error);
        const attachmentsList = document.getElementById('attachmentsList');
        if (attachmentsList) {
          attachmentsList.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: var(--brand-red);">
              <p>âŒ Ekler yÃ¼klenirken hata oluÅŸtu</p>
            </div>
          `;
        }
      }
    }

    /**
     * Delete contract attachment
     */
    window.deleteContractAttachment = async function(attachmentId) {
      if (!confirm('Bu eki silmek istediÄŸinizden emin misiniz?')) {
        return;
      }

      try {
        await deleteDoc(doc(db, 'contract_attachments', attachmentId));
        showAlert('âœ… Ek silindi', 'success');
        loadContractAttachments();
      } catch (error) {
        console.error('âŒ Error deleting attachment:', error);
        showAlert('âŒ Silme hatasÄ±: ' + error.message, 'danger');
      }
    };

    /**
     * Get file icon based on file extension
     */
    function getFileIcon(fileName) {
      const ext = fileName.split('.').pop().toLowerCase();
      const icons = {
        'pdf': 'ğŸ“•',
        'doc': 'ğŸ“˜',
        'docx': 'ğŸ“˜',
        'xls': 'ğŸ“—',
        'xlsx': 'ğŸ“—',
        'jpg': 'ğŸ–¼ï¸',
        'jpeg': 'ğŸ–¼ï¸',
        'png': 'ğŸ–¼ï¸',
        'gif': 'ğŸ–¼ï¸',
        'zip': 'ğŸ“¦',
        'rar': 'ğŸ“¦'
      };
      return icons[ext] || 'ğŸ“„';
    }

    /**
     * Show alert message
     */
    function showAlert(message, type = 'info') {
      const alertContainer = document.getElementById('alertContainer');
      if (!alertContainer) return;

      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type}`;
      alertDiv.style.cssText = `
        padding: 1rem 1.5rem;
        margin-bottom: 1rem;
        border-radius: 8px;
        background: ${type === 'success' ? '#4caf50' : type === 'danger' ? '#f44336' : '#ff9800'};
        color: white;
        animation: slideIn 0.3s ease;
      `;
      alertDiv.textContent = message;

      alertContainer.appendChild(alertDiv);

      // Auto remove after 4 seconds
      setTimeout(() => {
        alertDiv.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => alertDiv.remove(), 300);
      }, 4000);
    }

    setTimeout(() => {
      loadContract();
    }, 200);
  </script>
</body>
</html>

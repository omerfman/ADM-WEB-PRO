<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - ADM Ä°nÅŸaat Proje YÃ¶netim Sistemi</title>
  <link rel="stylesheet" href="css/style.css">
  <!-- SheetJS for Excel Import/Export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="dashboard-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="assets/adm_logo.png" alt="ADM Studio" class="sidebar-logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <h1 style="display: none;">ğŸ—ï¸ ADM Ä°nÅŸaat</h1>
      </div>
      
      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-section="projects" onclick="switchSection('projects')">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Projeler</span>
        </a>
        <a href="#" class="nav-item hidden" id="employeesNavBtn" data-section="employees" onclick="switchSection('employees')">
          <span class="nav-icon">ğŸ‘·</span>
          <span class="nav-text">Ã‡alÄ±ÅŸanlar</span>
        </a>
        <a href="#" class="nav-item hidden" id="activityNavBtn" data-section="activity" onclick="switchSection('activity')">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">Faaliyet KayÄ±tlarÄ±</span>
        </a>
        <a href="#" class="nav-item hidden" id="companiesNavBtn" data-section="companies" onclick="switchSection('companies')">
          <span class="nav-icon">ğŸ¢</span>
          <span class="nav-text">Åirketler</span>
        </a>
        <a href="#" class="nav-item hidden" id="usersNavBtn" data-section="users" onclick="switchSection('users')">
          <span class="nav-icon">ğŸ‘¥</span>
          <span class="nav-text">KullanÄ±cÄ±lar</span>
        </a>
      </nav>
      
      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar">ğŸ‘¤</div>
          <div class="user-details">
            <div class="user-name" id="sidebarUserName">KullanÄ±cÄ±</div>
            <div class="user-role" id="sidebarUserRole">Rol</div>
          </div>
        </div>
        <div class="sidebar-actions">
          <button id="sidebarThemeToggle" class="theme-toggle-btn" onclick="toggleTheme()">
            <span class="theme-option light-option">
              <span class="theme-circle light-circle">âšª</span>
              <span class="theme-label">Light</span>
            </span>
            <span class="theme-option dark-option active">
              <span class="theme-circle dark-circle">âš«</span>
              <span class="theme-label">Dark</span>
            </span>
          </button>
          <button id="logoutBtn" class="logout-btn" onclick="handleLogout()">Ã‡Ä±kÄ±ÅŸ Yap</button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Top Bar -->
      <div class="topbar">
        <button class="menu-toggle" id="menuToggle">â˜°</button>
        <h2 id="pageTitle">Projeler</h2>
        <div class="topbar-actions">
          <span id="userNameDisplay" class="topbar-user"></span>
        </div>
      </div>

      <div id="alertContainer"></div>

      <!-- Projects Section -->
      <section id="projectsSection" class="content-section">
        <div class="section-header">
          <h3>TÃ¼m Projeler</h3>
          <button class="btn btn-primary" onclick="openCreateProjectModal()">+ Yeni Proje</button>
        </div>
        
        <!-- Project Filters -->
        <div class="filter-bar" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
          <input type="text" id="projectSearchInput" placeholder="Proje adÄ± ara..." style="flex: 1; min-width: 200px; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary);">
          
          <select id="projectStatusFilter" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary);">
            <option value="">TÃ¼m Durumlar</option>
            <option value="Devam Ediyor">Devam Ediyor</option>
            <option value="TamamlandÄ±">TamamlandÄ±</option>
            <option value="Beklemede">Beklemede</option>
          </select>
          
          <div style="display: flex; gap: 0.5rem; align-items: center;">
            <label style="color: var(--text-secondary); font-size: 0.9rem;">Tarih:</label>
            <input type="date" id="projectStartDateFilter" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary);">
            <span style="color: var(--text-secondary);">-</span>
            <input type="date" id="projectEndDateFilter" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); color: var(--text-primary);">
          </div>
          
          <button class="btn btn-secondary" onclick="clearProjectFilters()" style="padding: 0.75rem 1.25rem;">ğŸ”„ Temizle</button>
          
          <div id="projectFilterResults" style="margin-left: auto; color: var(--text-secondary); font-size: 0.9rem; font-weight: 600;">
            <!-- Results count will be shown here -->
          </div>
        </div>
        
        <div id="projectsList" class="dashboard-grid">
          <!-- Projects will be loaded here -->
        </div>
      </section>

      <!-- Companies Section (Super Admin Only) -->
      <section id="companiesSection" class="content-section hidden">
        <div class="section-header">
          <h3>Åirketler</h3>
          <button class="btn btn-primary" onclick="openCreateCompanyModal()">+ Yeni Åirket</button>
        </div>
        <div id="companiesList" class="dashboard-grid">
          <!-- Companies will be loaded here -->
        </div>
      </section>

      <!-- Users Section (Company Admin) -->
      <section id="usersSection" class="content-section hidden">
        <div class="section-header">
          <h3>KullanÄ±cÄ±lar</h3>
          <button class="btn btn-primary" onclick="openCreateUserModal()">+ Yeni KullanÄ±cÄ±</button>
        </div>
        <div id="usersList" class="dashboard-grid">
          <!-- Users will be loaded here -->
        </div>
      </section>

      <!-- Employees Section (Company Admin - Employee Management) -->
      <section id="employeesSection" class="content-section hidden">
        <div class="section-header">
          <h3>Ã‡alÄ±ÅŸanlar</h3>
          <button class="btn btn-primary" onclick="openCreateEmployeeModal()">+ Yeni Ã‡alÄ±ÅŸan</button>
        </div>
        <div class="filter-bar" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
          <input type="text" id="employeeSearchInput" placeholder="Ä°sim, email ara..." style="flex: 1; min-width: 200px; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
          <select id="employeeRoleFilter" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
            <option value="">TÃ¼m Roller</option>
            <option value="user">KullanÄ±cÄ±</option>
            <option value="company_admin">Åirket Admin</option>
          </select>
          <select id="employeeStatusFilter" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
            <option value="">TÃ¼m Durumlar</option>
            <option value="active">Aktif</option>
            <option value="inactive">Pasif</option>
          </select>
        </div>
        <div id="employeesList" class="dashboard-grid">
          <!-- Employees will be loaded here -->
        </div>
      </section>

      <!-- Activity Logs Section -->
      <section id="activitySection" class="content-section hidden">
        <div class="section-header">
          <h3>Faaliyet KayÄ±tlarÄ±</h3>
        </div>
        <div class="filter-bar" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
          <input type="date" id="activityDateFrom" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
          <input type="date" id="activityDateTo" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
          <select id="activityTypeFilter" style="padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 8px;">
            <option value="">TÃ¼m Ä°ÅŸlemler</option>
            <option value="CREATE_PROJECT">Proje OluÅŸturma</option>
            <option value="UPDATE_PROJECT">Proje GÃ¼ncelleme</option>
            <option value="DELETE_PROJECT">Proje Silme</option>
            <option value="CREATE_USER">KullanÄ±cÄ± OluÅŸturma</option>
            <option value="UPDATE_USER">KullanÄ±cÄ± GÃ¼ncelleme</option>
            <option value="DELETE_USER">KullanÄ±cÄ± Silme</option>
            <option value="UPLOAD_PHOTO">FotoÄŸraf YÃ¼kleme</option>
          </select>
          <button class="btn btn-secondary" onclick="filterActivityLogs()" style="width: auto;">Filtrele</button>
          <button class="btn btn-secondary" onclick="clearActivityFilters()" style="width: auto;">Temizle</button>
        </div>
        <div id="activityLogsList" style="max-height: 600px; overflow-y: auto;">
          <!-- Activity logs will be loaded here -->
        </div>
      </section>
    </main>
  </div>

  <!-- Project Detail Modal -->
  <div id="projectDetailModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="projectTitle"></h2>
        <button class="modal-close" onclick="closeProjectModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin: 0.5rem 0; color: #666;"><strong>Konum:</strong> <span id="projectDetailLocation"></span></p>
        <p style="margin: 0.5rem 0; color: #666;"><strong>AÃ§Ä±klama:</strong> <span id="projectDetailDesc"></span></p>
        
        <!-- Quick Actions -->
        <div style="display: flex; gap: 0.5rem; margin: 1rem 0;">
          <button class="btn btn-secondary" onclick="openBudgetModal(window.currentProjectId || '')" style="width: auto; padding: 0.5rem 1rem; font-size: 0.9rem;">
            ğŸ’° BÃ¼tÃ§e YÃ¶netimi
          </button>
        </div>
        
        <!-- Tabs -->
        <div style="border-bottom: 2px solid var(--border-color); margin: 1.5rem 0 1rem 0;">
          <button class="tab-btn active" data-tab="logs" onclick="switchTab('logs')">ğŸ“‹ Åantiye GÃ¼nlÃ¼ÄŸÃ¼</button>
          <button class="tab-btn" data-tab="stocks" onclick="switchTab('stocks')">ğŸ“¦ Stok</button>
          <button class="tab-btn" data-tab="payments" onclick="switchTab('payments')">ğŸ’° HakediÅŸ</button>
        </div>

        <!-- Tab Contents -->
        <div id="logs-tab" class="tab-content">
          <h4 style="margin-top: 0;">Åantiye GÃ¼nlÃ¼ÄŸÃ¼</h4>
          <div id="logsList" style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;"></div>
          <button class="btn btn-secondary" onclick="openAddLogModal()" style="width: auto; margin-top: 1rem;">+ Log Ekle</button>
        </div>

        <div id="stocks-tab" class="tab-content hidden">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="margin: 0;">Stok Takibi</h4>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-secondary" onclick="downloadStockTemplate()" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background: #2196F3;">
                ğŸ“¥ Åablon Ä°ndir
              </button>
              <button class="btn btn-secondary" onclick="exportStocksToExcel(window.currentProjectId, document.getElementById('projectTitle').textContent)" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background: #4caf50;">
                ğŸ“Š Excel'e Aktar
              </button>
              <label class="btn btn-secondary" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background: #ff9800; cursor: pointer; margin: 0;">
                ğŸ“¤ Excel'den Ä°Ã§e Aktar
                <input type="file" accept=".xlsx,.xls" onchange="importStocksFromExcel(event, window.currentProjectId)" style="display: none;">
              </label>
            </div>
          </div>
          <div id="stocksList" style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;"></div>
          <button class="btn btn-secondary" onclick="openAddStockModal()" style="width: auto; margin-top: 1rem;">+ ÃœrÃ¼n Ekle</button>
        </div>

        <div id="payments-tab" class="tab-content hidden">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h4 style="margin: 0;">HakediÅŸ Listesi</h4>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-secondary" onclick="downloadPaymentTemplate()" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background: #2196F3;">
                ğŸ“¥ Åablon Ä°ndir
              </button>
              <button class="btn btn-secondary" onclick="exportPaymentsToExcel(window.currentProjectId, document.getElementById('projectTitle').textContent)" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background: #4caf50;">
                ğŸ“Š Excel'e Aktar
              </button>
              <label class="btn btn-secondary" style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background: #ff9800; cursor: pointer; margin: 0;">
                ğŸ“¤ Excel'den Ä°Ã§e Aktar
                <input type="file" accept=".xlsx,.xls" onchange="importPaymentsFromExcel(event, window.currentProjectId)" style="display: none;">
              </label>
            </div>
          </div>
          <div id="paymentsList" style="max-height: 300px; overflow-y: auto; margin-bottom: 1rem;"></div>
          <div style="padding: 1rem; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 4px; margin-bottom: 1rem;">
            <strong>Toplam HakediÅŸ: â‚º<span id="totalPayments">0</span></strong>
          </div>
          <button class="btn btn-secondary" onclick="openAddPaymentModal()" style="width: auto; margin-top: 1rem;">+ HakediÅŸ Ekle</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeProjectModal()">Kapat</button>
      </div>
    </div>
  </div>

  <!-- Add Log Modal -->
  <div id="addLogModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Åantiye GÃ¼nlÃ¼ÄŸÃ¼ Ekle</h2>
        <button class="modal-close" onclick="closeAddLogModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addLogForm" onsubmit="handleAddLog(event)">
          <div class="form-group">
            <label for="logTitle">YapÄ±lan Ä°ÅŸ *</label>
            <input type="text" id="logTitle" placeholder="Ã–rn: Temel kazÄ±sÄ± tamamlandÄ±" required>
          </div>
          <div class="form-group">
            <label for="logDescription">AÃ§Ä±klama</label>
            <textarea id="logDescription" placeholder="DetaylÄ± aÃ§Ä±klama (opsiyonel)" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; height: 100px;"></textarea>
          </div>
          <div class="form-group">
            <label for="logWorker">Ä°ÅŸÃ§i/Sorumluluk *</label>
            <input type="text" id="logWorker" placeholder="Yapan kiÅŸi adÄ±" required>
          </div>
          <div class="form-group">
            <label for="logPhoto">FotoÄŸraf (opsiyonel)</label>
            <input type="file" id="logPhoto" accept="image/*">
            <small style="color: #999;">Max 5MB</small>
          </div>
          <button type="submit" class="btn btn-primary">Kaydet</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Add Stock Modal -->
  <div id="addStockModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Stok Ekle</h2>
        <button class="modal-close" onclick="closeAddStockModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addStockForm" onsubmit="handleAddStock(event)">
          <div class="form-group">
            <label for="stockName">ÃœrÃ¼n AdÄ± *</label>
            <input type="text" id="stockName" placeholder="Ã–rn: Ã‡imento, Ã‡elik, AhÅŸap" required>
          </div>
          <div class="form-group">
            <label for="stockUnit">Birim *</label>
            <select id="stockUnit" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px;">
              <option value="">SeÃ§</option>
              <option value="kg">Kg</option>
              <option value="lt">Lt</option>
              <option value="m">Metre</option>
              <option value="m2">mÂ²</option>
              <option value="m3">mÂ³</option>
              <option value="adet">Adet</option>
              <option value="ton">Ton</option>
            </select>
          </div>
          <div class="form-group">
            <label for="stockQuantity">Miktar *</label>
            <input type="number" id="stockQuantity" placeholder="0" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="stockUnitPrice">Birim Fiyat (â‚º) *</label>
            <input type="number" id="stockUnitPrice" placeholder="0" min="0" step="0.01" required>
          </div>
          <button type="submit" class="btn btn-primary">Kaydet</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Add Payment Modal -->
  <div id="addPaymentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>HakediÅŸ Ekle</h2>
        <button class="modal-close" onclick="closeAddPaymentModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addPaymentForm" onsubmit="handleAddPayment(event)">
          <div class="form-group">
            <label for="paymentDescription">YapÄ±lan Ä°ÅŸ *</label>
            <input type="text" id="paymentDescription" placeholder="Ã–rn: Ä°nsan gÃ¼nÃ¼, Makine kiralama" required>
          </div>
          <div class="form-group">
            <label for="paymentWorker">Kimin YaptÄ±ÄŸÄ± *</label>
            <input type="text" id="paymentWorker" placeholder="Ä°ÅŸÃ§i/MÃ¼teahhit adÄ±" required>
          </div>
          <div class="form-group">
            <label for="paymentUnit">Birim *</label>
            <select id="paymentUnit" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px;">
              <option value="">SeÃ§</option>
              <option value="Insan Gunu">Ä°nsan GÃ¼nÃ¼</option>
              <option value="Makine Saati">Makine Saati</option>
              <option value="Makine Gunu">Makine GÃ¼nÃ¼</option>
              <option value="Proje">Proje TaÅŸÄ±ma (toplamÄ±)</option>
              <option value="Adet">Adet</option>
              <option value="m">Metre</option>
              <option value="m2">mÂ²</option>
              <option value="m3">mÂ³</option>
            </select>
          </div>
          <div class="form-group">
            <label for="paymentAmount">Birim FiyatÄ± (â‚º) *</label>
            <input type="number" id="paymentAmount" placeholder="0" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="paymentQuantity">Miktar *</label>
            <input type="number" id="paymentQuantity" placeholder="1" min="0.01" step="0.01" required value="1">
          </div>
          <button type="submit" class="btn btn-primary">Kaydet</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Budget Management Modal -->
  <div id="budgetModal" class="modal">
    <div class="modal-content" style="max-width: 1200px;">
      <div class="modal-header">
        <h2>ğŸ’° BÃ¼tÃ§e YÃ¶netimi - <span id="budgetProjectName"></span></h2>
        <button class="modal-close" onclick="closeBudgetModal()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Budget Settings -->
        <div style="background: var(--card-bg); padding: 1.5rem; border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 1.5rem;">
          <h3 style="margin-top: 0;">Proje BÃ¼tÃ§esi</h3>
          <form onsubmit="updateProjectBudget(event)" style="display: grid; grid-template-columns: 1fr auto auto; gap: 1rem; align-items: end;">
            <div class="form-group" style="margin: 0;">
              <label for="budgetTotalAmount">Toplam BÃ¼tÃ§e</label>
              <input type="number" id="budgetTotalAmount" placeholder="0" min="0" step="0.01" required style="width: 100%;">
            </div>
            <div class="form-group" style="margin: 0;">
              <label for="budgetCurrency">Para Birimi</label>
              <select id="budgetCurrency" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px;">
                <option value="TRY">TRY (â‚º)</option>
                <option value="USD">USD ($)</option>
                <option value="EUR">EUR (â‚¬)</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary" style="margin: 0;">GÃ¼ncelle</button>
          </form>
        </div>

        <!-- Budget Summary -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">Toplam BÃ¼tÃ§e</div>
            <div style="font-size: 1.5rem; font-weight: bold;">â‚º<span id="budgetSummaryTotal">0</span></div>
          </div>
          <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">Harcama KayÄ±tlarÄ±</div>
            <div style="font-size: 1.5rem; font-weight: bold;">â‚º<span id="budgetSummaryExpenses">0</span></div>
          </div>
          <div style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">Stok</div>
            <div style="font-size: 1.5rem; font-weight: bold;">â‚º<span id="budgetSummaryStocks">0</span></div>
          </div>
          <div style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">HakediÅŸ</div>
            <div style="font-size: 1.5rem; font-weight: bold;">â‚º<span id="budgetSummaryPayments">0</span></div>
          </div>
          <div style="background: linear-gradient(135deg, #ff9a56 0%, #ff6a88 100%); color: white; padding: 1.5rem; border-radius: 8px;">
            <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">Toplam Harcama</div>
            <div style="font-size: 1.5rem; font-weight: bold;">â‚º<span id="budgetSummaryGrandTotal">0</span></div>
          </div>
          <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #333; padding: 1.5rem; border-radius: 8px;">
            <div style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 0.5rem;">Kalan BÃ¼tÃ§e</div>
            <div style="font-size: 1.5rem; font-weight: bold;">â‚º<span id="budgetSummaryRemaining">0</span></div>
            <div style="margin-top: 0.5rem;">
              <div style="background: rgba(0,0,0,0.1); height: 6px; border-radius: 3px; overflow: hidden;">
                <div id="budgetProgressBar" style="height: 100%; transition: width 0.3s;"></div>
              </div>
              <div style="margin-top: 0.25rem; font-size: 0.75rem;">KullanÄ±m: <span id="budgetSummaryPercentage">0%</span></div>
            </div>
          </div>
        </div>

        <!-- Budget Tabs -->
        <div style="border-bottom: 2px solid var(--border-color); margin-bottom: 1rem;">
          <button class="tab-btn active" onclick="document.getElementById('budget-categories-tab').classList.remove('hidden'); document.getElementById('budget-expenses-tab').classList.add('hidden');">
            ğŸ“ BÃ¼tÃ§e Kategorileri
          </button>
          <button class="tab-btn" onclick="document.getElementById('budget-expenses-tab').classList.remove('hidden'); document.getElementById('budget-categories-tab').classList.add('hidden');">
            ğŸ’¸ Harcama KayÄ±tlarÄ±
          </button>
        </div>

        <!-- Budget Categories Tab -->
        <div id="budget-categories-tab">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0;">BÃ¼tÃ§e Kategorileri</h3>
            <button class="btn btn-primary" onclick="openAddCategoryModal()">+ Kategori Ekle</button>
          </div>
          <div id="budgetCategoriesList" style="max-height: 400px; overflow-y: auto;"></div>
        </div>

        <!-- Budget Expenses Tab -->
        <div id="budget-expenses-tab" class="hidden">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3 style="margin: 0;">Harcama KayÄ±tlarÄ±</h3>
            <button class="btn btn-primary" onclick="openAddExpenseModal()">+ Harcama Ekle</button>
          </div>
          <div id="budgetExpensesList" style="max-height: 400px; overflow-y: auto;"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBudgetModal()">Kapat</button>
      </div>
    </div>
  </div>

  <!-- Add Budget Category Modal -->
  <div id="addCategoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Kategori Ekle</h2>
        <button class="modal-close" onclick="closeAddCategoryModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addCategoryForm" onsubmit="addBudgetCategory(event)">
          <div class="form-group">
            <label for="categoryName">Kategori AdÄ± *</label>
            <input type="text" id="categoryName" placeholder="Ã–rn: Malzeme, Ä°ÅŸÃ§ilik, Ekipman" required>
          </div>
          <div class="form-group">
            <label for="categoryAllocated">Planlanan BÃ¼tÃ§e (â‚º) *</label>
            <input type="number" id="categoryAllocated" placeholder="0" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="categoryDescription">AÃ§Ä±klama</label>
            <textarea id="categoryDescription" rows="3" placeholder="Kategori aÃ§Ä±klamasÄ± (opsiyonel)"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Kaydet</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Add Budget Expense Modal -->
  <div id="addExpenseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Harcama Ekle</h2>
        <button class="modal-close" onclick="closeAddExpenseModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="addExpenseForm" onsubmit="addBudgetExpense(event)">
          <div class="form-group">
            <label for="expenseCategory">Kategori *</label>
            <select id="expenseCategory" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px;">
              <option value="">Kategori SeÃ§in</option>
            </select>
          </div>
          <div class="form-group">
            <label for="expenseDescription">AÃ§Ä±klama *</label>
            <input type="text" id="expenseDescription" placeholder="Harcama aÃ§Ä±klamasÄ±" required>
          </div>
          <div class="form-group">
            <label for="expenseAmount">Tutar (â‚º) *</label>
            <input type="number" id="expenseAmount" placeholder="0" min="0" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="expenseDate">Tarih *</label>
            <input type="date" id="expenseDate" required>
          </div>
          <div class="form-group">
            <label for="expenseNotes">Notlar</label>
            <textarea id="expenseNotes" rows="3" placeholder="Ek notlar (opsiyonel)"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Kaydet</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Create Project Modal -->
  <div id="createProjectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Yeni Proje OluÅŸtur</h2>
        <button class="modal-close" onclick="closeCreateProjectModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="createProjectForm" onsubmit="handleCreateProject(event)">
          <div class="form-group">
            <label for="projectName">Proje AdÄ±</label>
            <input type="text" id="projectName" placeholder="Proje adÄ±nÄ± girin" required>
          </div>
          <div class="form-group">
            <label for="projectDesc">AÃ§Ä±klama</label>
            <textarea id="projectDesc" placeholder="Proje aÃ§Ä±klamasÄ±" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; resize: vertical; height: 100px;"></textarea>
          </div>
          <div class="form-group">
            <label for="projectLocation">Konum</label>
            <input type="text" id="projectLocation" placeholder="Proje konumu" required>
          </div>
          <button type="submit" class="btn btn-primary">Proje OluÅŸtur</button>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeCreateProjectModal()">Ä°ptal</button>
      </div>
    </div>
  </div>

  <!-- Create User Modal (Company Admin) -->
  <div id="createUserModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Yeni KullanÄ±cÄ± OluÅŸtur</h2>
        <button class="modal-close" onclick="closeCreateUserModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="createUserForm" onsubmit="handleCreateUser(event)">
          <div class="form-group">
            <label for="userEmail">E-posta *</label>
            <input type="email" id="userEmail" placeholder="kullanici@example.com" required>
          </div>
          <div class="form-group">
            <label for="userPassword">Åifre *</label>
            <input type="password" id="userPassword" placeholder="En az 6 karakter" required minlength="6">
          </div>
          <div class="form-group">
            <label for="userFullName">Ad Soyad *</label>
            <input type="text" id="userFullName" placeholder="Tam adÄ± girin" required>
          </div>
          <div class="form-group">
            <label for="userRole">Rol *</label>
            <select id="userRole" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px;">
              <option value="">SeÃ§iniz</option>
              <option value="user">KullanÄ±cÄ±</option>
              <option value="company_admin">Åirket Admin</option>
            </select>
          </div>
          <button type="submit" class="btn btn-primary">KullanÄ±cÄ± OluÅŸtur</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Create Employee Modal (same as user but with additional fields) -->
  <div id="createEmployeeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Yeni Ã‡alÄ±ÅŸan Ekle</h2>
        <button class="modal-close" onclick="closeCreateEmployeeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="createEmployeeForm" onsubmit="handleCreateEmployee(event)">
          <div class="form-group">
            <label for="empEmail">E-posta *</label>
            <input type="email" id="empEmail" placeholder="calisan@example.com" required>
          </div>
          <div class="form-group">
            <label for="empPassword">Åifre *</label>
            <input type="password" id="empPassword" placeholder="En az 6 karakter" required minlength="6">
          </div>
          <div class="form-group">
            <label for="empFullName">Ad Soyad *</label>
            <input type="text" id="empFullName" placeholder="Tam adÄ± girin" required>
          </div>
          <div class="form-group">
            <label for="empRole">Yetki Seviyesi *</label>
            <select id="empRole" required style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px;">
              <option value="">SeÃ§iniz</option>
              <option value="user">Standart KullanÄ±cÄ±</option>
              <option value="company_admin">Åirket YÃ¶neticisi</option>
            </select>
          </div>
          <div class="form-group">
            <label for="empPhone">Telefon</label>
            <input type="tel" id="empPhone" placeholder="+90 XXX XXX XXXX">
          </div>
          <div class="form-group">
            <label for="empPosition">Pozisyon</label>
            <input type="text" id="empPosition" placeholder="Ã–rn: Åantiye Åefi, MÃ¼hendis">
          </div>
          <button type="submit" class="btn btn-primary">Ã‡alÄ±ÅŸan Ekle</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Create Company Modal (Super Admin) -->
  <div id="createCompanyModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Yeni Åirket OluÅŸtur</h2>
        <button class="modal-close" onclick="closeCreateCompanyModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="createCompanyForm" onsubmit="handleCreateCompany(event)">
          <div class="form-group">
            <label for="companyName">Åirket AdÄ± *</label>
            <input type="text" id="companyName" placeholder="Åirket adÄ±" required>
          </div>
          <div class="form-group">
            <label for="companyEmail">Åirket E-posta *</label>
            <input type="email" id="companyEmail" placeholder="contact@company.com" required>
          </div>
          <div class="form-group">
            <label for="companyPhone">Telefon</label>
            <input type="tel" id="companyPhone" placeholder="+90 XXX XXX XXXX">
          </div>
          <div class="form-group">
            <label for="companyAddress">Adres</label>
            <textarea id="companyAddress" placeholder="Åirket adresi" style="width: 100%; padding: 0.75rem; border: 1px solid var(--border-color); border-radius: 4px; height: 80px;"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Åirket OluÅŸtur</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase Config -->
  <script type="module" src="js/firebase-config.js"></script>
  
  <!-- API Config -->
  <script src="js/api-config.js"></script>
  
  <!-- Debug Console -->
  <script type="module" src="js/debug.js"></script>
  
  <!-- Auth Module -->
  <script type="module" src="js/auth.js"></script>
  
  <!-- Projects Module -->
  <script type="module" src="js/projects.js"></script>
  
  <!-- Users Management Module -->
  <script type="module" src="js/users.js"></script>
  
  <!-- Companies Management Module -->
  <script type="module" src="js/companies.js"></script>
  
  <!-- Employees Management Module -->
  <script type="module" src="js/employees.js"></script>
  
  <!-- Activity Logs Module -->
  <script type="module" src="js/activity.js"></script>
  
  <!-- Additional Modules -->
  <script type="module" src="js/upload.js"></script>
  <script type="module" src="js/budget.js"></script>
  <script type="module" src="js/excel.js"></script>
  <script type="module" src="js/audit.js"></script>
  <script type="module" src="js/security.js"></script>
  <script type="module" src="js/security-monitoring.js"></script>
  <script type="module" src="js/config-vercel.js"></script>
  
  <!-- Dashboard App Initialization -->
  <script type="module" src="js/app.js"></script>

  <!-- Dashboard Specific Scripts -->
  <script>
    // Section switching
    function switchSection(section) {
      // Hide all sections
      document.querySelectorAll('.content-section').forEach(s => s.classList.add('hidden'));
      
      // Show selected section
      document.getElementById(section + 'Section').classList.remove('hidden');
      
      // Update navigation active state
      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
      document.querySelector(`[data-section="${section}"]`).classList.add('active');
      
      // Update page title
      const titles = {
        'projects': 'Projeler',
        'companies': 'Åirketler',
        'users': 'KullanÄ±cÄ±lar'
      };
      document.getElementById('pageTitle').textContent = titles[section] || section;
    }

    // Tab switching in project modal
    function switchTab(tab) {
      // Hide all tabs
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      
      // Show selected tab
      document.getElementById(tab + '-tab').classList.remove('hidden');
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
    }

    // Mobile menu toggle
    document.getElementById('menuToggle').addEventListener('click', function() {
      document.querySelector('.sidebar').classList.toggle('sidebar-open');
    });

    // Theme toggle - Default to dark mode
    const themeToggle = document.getElementById('sidebarThemeToggle');
    const currentTheme = localStorage.getItem('theme') || 'dark'; // Changed default to dark
    
    if (currentTheme === 'dark') {
      document.body.classList.add('dark-mode');
      themeToggle.textContent = 'â˜€ï¸';
    }
    
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });

    // Close sidebar on mobile when clicking outside
    document.addEventListener('click', function(event) {
      const sidebar = document.querySelector('.sidebar');
      const menuToggle = document.getElementById('menuToggle');
      
      if (window.innerWidth <= 768 && 
          sidebar.classList.contains('sidebar-open') && 
          !sidebar.contains(event.target) && 
          event.target !== menuToggle) {
        sidebar.classList.remove('sidebar-open');
      }
    });
  </script>
</body>
</html>
